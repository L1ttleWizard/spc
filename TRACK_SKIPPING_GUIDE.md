# Руководство по тестированию переключения треков

## Что было исправлено

1. **Добавлены новые thunks** для переключения треков:
   - `skipToPrevious` - переключение на предыдущий трек
   - `skipToNext` - переключение на следующий трек

2. **Добавлены обработчики** в компонент Player:
   - `handleSkipToPrevious` - обработчик кнопки "назад"
   - `handleSkipToNext` - обработчик кнопки "вперед"

3. **Добавлено логирование** для отладки:
   - Логи в консоли браузера при нажатии кнопок
   - Логи в thunks для отслеживания API запросов
   - Обработка ошибок с подробными сообщениями

## Как тестировать

### 1. Подготовка
- Убедитесь, что у вас есть активный Spotify аккаунт
- Войдите в приложение через Spotify
- Убедитесь, что плеер инициализирован (Device ID должен появиться)

### 2. Тестирование переключения треков

#### Вариант A: Через плейлист
1. Откройте любой плейлист в Spotify (через официальное приложение)
2. Начните воспроизведение
3. В вашем приложении нажмите кнопки ⏮️ (назад) или ⏭️ (вперед)
4. Проверьте, что трек изменился

#### Вариант B: Через альбом
1. Откройте альбом в Spotify
2. Начните воспроизведение
3. Тестируйте переключение треков

### 3. Проверка логов

Откройте консоль браузера (F12) и проверьте следующие сообщения:

**При успешном переключении:**
```
Переключаем на следующий трек
Отправляем запрос на следующий трек...
Успешно переключились на следующий трек
```

**При ошибках:**
```
Skip to next: неактивно или нет токена
Skip to next: No device ID
Skip to next failed: 403 Forbidden
```

### 4. Возможные проблемы

#### Проблема: "неактивно или нет токена"
**Решение:** Убедитесь, что:
- Вы вошли в Spotify
- Плеер инициализирован (есть Device ID)
- Токен не истек

#### Проблема: "No device ID"
**Решение:** 
- Перезагрузите страницу
- Проверьте, что Spotify Web Playback SDK загрузился
- Убедитесь, что в консоли есть сообщение "Плеер готов с ID устройства"

#### Проблема: "403 Forbidden"
**Решение:**
- Проверьте, что у приложения есть права на управление воспроизведением
- Убедитесь, что в Spotify App настроены правильные scopes
- Проверьте, что токен не истек

### 5. Scopes для Spotify App

Убедитесь, что в настройках вашего Spotify App есть следующие scopes:
- `user-modify-playback-state` - для переключения треков
- `user-read-playback-state` - для чтения состояния плеера
- `streaming` - для воспроизведения

### 6. Отладка через компонент PlayerDebug

Если у вас есть проблемы, временно добавьте компонент отладки обратно:

```tsx
import PlayerDebug from '@/components/PlayerDebug';

// В JSX
<PlayerDebug />
```

Это покажет текущее состояние плеера и поможет диагностировать проблемы.

## API Endpoints

Переключение треков использует следующие Spotify API endpoints:
- `POST /me/player/previous` - предыдущий трек
- `POST /me/player/next` - следующий трек

Оба требуют параметр `device_id` и заголовок `Authorization: Bearer {access_token}`. 